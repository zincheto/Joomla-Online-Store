/*
 boxplus: a lightweight pop-up window engine shipped with sigplus
 @author  Levente Hunyadi
 @version 1.4.2
 @remarks Copyright (C) 2009-2010 Levente Hunyadi
 @remarks Licensed under GNU/GPLv3, see http://www.gnu.org/licenses/gpl-3.0.html
 @see     http://hunyadi.info.hu/projects/boxplus
*/
if(typeof __jQuery__=="undefined")var __jQuery__=jQuery;
(function(c){function z(a,b){var c=parseInt(a.css(b));return isNaN(c)?a[b]():c}function o(a){return z(a,"width")}function E(a,b){return parseInt(a.css("margin-"+b))||0}function va(a){var b=a.attr("src"),c=a.attr("longdesc");a=a.attr("data-thumb");return{src:a?a:b&&b!="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="?b:/\.(gif|jpe?g|png)$/i.test(c)?c:!1}}function d(a,b){return c(".boxplus-"+a,b)}function U(a){a=c(a);h=c.extend({},V,a.data("boxplus"));var b=h.theme;
b&&c("link[rel=stylesheet][title^=boxplus]").attr("disabled","disabled").filter('[title="boxplus-'+b+'"]').removeAttr("disabled");L.removeClass("boxplus-hidden");d("m",e).addClass("boxplus-hidden");d("title",e).addClass("boxplus-unavailable");e.removeClass("boxplus-disabled").css({width:M,height:N}).css(W(M,N)).removeClass("boxplus-hidden");A(e,!0);O.bind("keydown",X);h.contextmenu||O.bind("contextmenu",F).bind("dragstart",F);k=(b=a.attr("rel"))?c('a[rel="'+b+'"]'):a;a=a.attr("href");var g=k.map(function(){return c(this).attr("href")}).get();
k=k.filter(function(a){return c.inArray(c(this).attr("href"),g)>=a});t=(Z=h.rtl)?"right":"left";f.empty().css({left:"auto",right:"auto"}).css(t,0);k.each(function(a){var b=c("img:first",this);c("<li />").append((b.size()?c("<img />").attr(va(b)):c()).click(function(){m();r(a)})).appendTo(f)});u.removeClass("boxplus-disabled").each(function(){var a=c("ul",this);c(this).toggleClass("boxplus-unavailable",a.children().size()<2)});b=h.thumbs=="outside";u.toggleClass("boxplus-disabled",!b).filter(j.children()).toggleClass("boxplus-disabled",
b);G.toggleClass("boxplus-unavailable",k.length<2||!h.slideshow);r(c.inArray(a,g))}function P(){m();O.unbind("keydown",X).unbind("contextmenu",F).unbind("dragstart",F);e.stop(!0,!0);i=-1;e.addClass("boxplus-disabled").add(B).add(j).add(L).addClass("boxplus-hidden")}function wa(){m();r(0)}function Q(){m();r(i-1)}function R(){m();r(i+1)}function xa(){m();r(k.length-1)}function r(a){var b=k.length;if(a!=i&&(h.loop||a>=0&&a<b))i=(a+b)%b,$(!0),aa()}function m(){v&&(clearTimeout(v),v=0);H.addClass("boxplus-disabled");
G.removeClass("boxplus-disabled")}function ya(){ba();G.addClass("boxplus-disabled");H.removeClass("boxplus-disabled")}function za(){m();$(!C.hasClass("boxplus-hidden"));aa()}function I(){j.addClass("boxplus-hidden");A(j,!1);A(e,!0);B.addClass("boxplus-hidden");var a=h.autofit,b={},g={},Y={};Aa(a&&C.hasClass("boxplus-hidden"),b,g,Y);j.css(b);D.attr("src",k.eq(i).attr("href"));J.toggleClass("boxplus-unavailable",!a||!p||b.width==p.width&&C.hasClass("boxplus-hidden"));f.each(function(){c(this).children().removeClass("boxplus-active").eq(i).addClass("boxplus-active")});
d("m",e).addClass("boxplus-hidden");e.animate(c.extend(Y,g),h.duration,h.easing,Ba)}function Ca(){m();window.location.href=h.download(k.eq(i))}function ca(){m();j.children().slice(0,-1).toggleClass("boxplus-hidden")}function da(a){var b=a.attr("id");b=b?"boxplus-"+b:"boxplus";c("li",a).each(function(){c("a:first",this).attr("rel",b)});return c("a[rel="+b+"]",a)}function aa(){v&&(clearTimeout(v),v=0);e.stop(!0,!0);f.stop();B.addClass("boxplus-hidden");A(j,!0);s.empty();ea.addClass("boxplus-unavailable");
var a=k.eq(i),b=a[0],g=a.attr("href"),d=b.pathname;c.boxplus.onchange(g,i);/^#/.test(g)?(s.append(c(g).clone().contents()),K()):/\.(txt|html?)$/i.test(d)?s.load(g,{},K):/\.(gif|jpe?g|png)$/i.test(d)?fa(a):/\.(mov|mpe?g|ogg|swf|webM|wmv)$/i.test(d)||/youtube\.com$/.test(b.hostname)?ga(a):c.ajax({url:g,success:function(b,c,d){b=d.getResponseHeader("Content-Type");/^text\/(plain|html)/.test(b)?s.load(g,{},K):/^image\/(gif|jpeg|png)/.test(b)?fa(a):/^application\/x-shockwave-flash/.test(b)&&ga(a)},type:"head"})}
function fa(a){var b=h.metadata(a);b&&s.append(c.inArray(c.type(b),["boolean","number","string"])>=0?b:b.clone());D.removeClass("boxplus-unavailable");c(p=new Image).load(I).error(K).attr("src",a.attr("href"))}function ga(a){for(var b=a.attr("href"),g={},d=a[0].search.replace(/^\?/,"").split("&"),e=0;e<d.length;e++)if(d[e]){var f=d[e].split("=");g[f[0]]=f[1]}d=parseInt(g.width)||640;g=parseInt(g.height)||480;g={width:d,height:g};a=a[0].pathname;/\.(ogg|webM)$/i.test(a)?S.attr(c.extend({src:b},g)).removeClass("boxplus-unavailable"):
(d="application/x-shockwave-flash",e="D27CDB6E-AE6D-11cf-96B8-444553540000",/\.mov$/i.test(a)&&(d="video/quicktime",e="02BF25D5-8C17-4B23-BC80-D3488ABDDC6B"),T.empty().append("<object"+ha(c.extend({classid:"clsid:"+e},g))+">"+Da({movie:b})+"<\!--[if lt IE 9]><\!--\><object"+ha(c.extend({type:d,data:b},g))+"></object><\!--<![endif]--\></object>").removeClass("boxplus-unavailable"));p=c.extend({},g);I()}function ha(a){var b="",c;for(c in a)b+=" "+c+'="'+a[c]+'"';return b}function Da(a){var b="",c;for(c in a)b+=
'<param name="'+c+'" value="'+a[c]+'" />';return b}function K(){p=null;I()}function Ba(){d("m",e).removeClass("boxplus-hidden");var a=w(f.children().eq(i));if(l<0){var b=o(u),c=o(f);f.css(t,-(c<b?w(f.children().eq(0)):Math.min(a,c-b)))}else l=i,f.css(t,-a);x();j.removeClass("boxplus-hidden");a=h.loop;ia.toggleClass("boxplus-unavailable",!a&&i==0);ja.toggleClass("boxplus-unavailable",!a&&i>=k.length-1);j.children().removeClass("boxplus-hidden");a=p&&p.src;b=!s.is(":empty");ka.toggleClass("boxplus-unavailable",
!h.download(k.eq(i)));la.toggleClass("boxplus-unavailable",!a||!b);s.addClass("boxplus-hidden");a||!b||ca();A(e,!1);ma(e,!1);a={width:o(e)+d("sideways",e).trueWidth(),height:z(e,"height")+na(e)};e.animate(a,h.duration,h.easing,function(){B.removeClass("boxplus-hidden");!h.loop&&i>=k.length-1&&m();!H.hasClass("boxplus-disabled")&&ba()})}function ba(){v=setTimeout(function(){r(i+1)},h.slideshow)}function w(a){var b=a.position().left;return Z?a.offsetParent().width()-a.width()-b:b}function x(){var a=
o(f.parent())-o(f),b=w(f);oa.toggleClass("boxplus-hidden",b>=0);pa.toggleClass("boxplus-hidden",a>0||b<=a)}function qa(){m();var a={};a[t]=-w(f.children().eq(l));f.animate(a,"fast","linear",x);return!1}function Ea(){l>0&&(l--,qa())}function Fa(){l>=0&&l+1<k.size()&&(l++,qa())}function Ga(){if(l<0){m();var a={};a[t]=0;f.animate(a,-4*w(f),"linear",x)}}function Ha(){if(l<0){m();var a=o(u),b=o(f),c=w(f),d=a-b;b+c<a?x():(a={},a[t]=d,f.animate(a,-4*(d-c),"linear",x))}}function ra(){f.stop();x()}function $(a){d("enlarge",
J).toggleClass("boxplus-hidden",!a);C.toggleClass("boxplus-hidden",a)}function ma(a,b){var c=k.eq(i),e=h.title(c);c=h.description(c,b);d("title",a).toggleClass("boxplus-unavailable",!e).html(e);d("text",a).toggleClass("boxplus-unavailable",!c||c==e).empty().append(c)}function A(a,b){var c=d("progress",a).toggleClass("boxplus-hidden",!b);window.clearInterval(c.data("boxplus"));b&&c.data("boxplus",window.setInterval(function(){c.css("background-position",sa=(sa-32)%384)},150))}function na(a){return d("caption",
a).trueHeight()+d("controls",a).trueHeight()}function W(a,b){var d=c(window).innerWidth()/2,e=c(window).innerHeight()/2,f=Math.max;return{left:f(0,c(window).scrollLeft()+d-a/2),top:f(0,c(window).scrollTop()+e-b/2)}}function Aa(a,b,e,h){c.extend(b,{width:p?p.width:ta,height:p?p.height:ua});ma(d("caption",n.removeClass("boxplus-unavailable")),!0);var i=d("thumbs > ul",n);f.eq(0).children().clone().appendTo(i);d("thumbs",n).each(function(a){a=u.eq(a);c(this).toggleClass("boxplus-disabled",a.hasClass("boxplus-disabled")).toggleClass("boxplus-unavailable",
a.hasClass("boxplus-unavailable"))});var k=d("sideways",n),j=d("main",n);j=j.trueWidth()-o(j)+k.trueWidth();var m=d("viewer",n.css("width",b.width+j)).css(b);if(a)for(var l=c(window).innerWidth()-E(y,"left")-E(y,"right"),q=n.outerWidth(!0);q>l;)q=l/q,b.width*=q,b.height*=q,m.css(b),q=n.css("width",b.width+j).outerWidth(!0);l=n.outerHeight(!0);if(a)for(a=c(window).innerHeight()-E(y,"top")-E(y,"bottom");l>a;)q=a/l,b.width*=q,b.height*=q,m.css(b),l=n.css("width",b.width+j).outerHeight(!0);e.width=o(n)-
k.trueWidth();e.height=z(n,"height")-na(n);c.extend(h,W(n.trueWidth(),l));i.empty();n.addClass("boxplus-unavailable")}function X(a){if(c.inArray(a.target.tagName.toLowerCase(),["input","textarea"])<0)return a=c.inArray(a.which,[27,37,39,36,35]),a<0||[P,Q,R,wa,xa][a](),!1}function F(a){return!c("img",f).add(D).filter(a.target).size()}var V={rtl:!1,theme:!1,autofit:!0,slideshow:0,duration:"slow",easing:"swing",loop:!1,contextmenu:!0,thumbs:"inside",title:function(a){a=c("img:first",a);return a.size()?
a.attr("alt"):""},description:function(a){return a.attr("title")},download:function(){return!1},metadata:function(){return""}},h,L,e,n,M,N,ta,ua,j,D,s,S,T,ea,ia,ja,G,H,ka,la,J,C,u,f,oa,pa,B,O=c(document),y,p,k,i=-1,sa=0,l=-1,v,Z,t;c.fn.trueWidth=function(){return this.filter(":visible").size()?this.outerWidth(!0):0};c.fn.trueHeight=function(){return this.filter(":visible").size()?this.outerHeight(!0):0};c(function(){function a(a,b){return"<div"+(a?' class="boxplus-'+(c.isArray(a)?a.join(" "):a)+'"':
"")+">"+(b?b:"")+"</div>"}y=c("body");var b=a("prev")+a("next"),g=a("caption",a("title")+a("text")),h=a("controls",b+a("start")+a(["stop","boxplus-disabled"])+a("close")+a("download")+a("metadata")),i="<ul />"+a("rewind")+a("forward");b=c('<div id="boxplus">'+a(["background","boxplus-hidden"])+a(["dialog","boxplus-hidden"],a("title")+a("main",a(["viewer","boxplus-hidden"],a(["content","boxplus-hidden"])+"<img /><video controls />"+a("flash")+b+a("resizer",a("enlarge")+a(["shrink","boxplus-hidden"]))+
a("thumbs",i)+a("progress"))+a("bottom",a("thumbs",i)+g+h))+a(["sideways","boxplus-disabled"],a("thumbs",i)+h+g)+a("lt")+a("t")+a("rt")+a("l")+a("m")+a("r")+a("lb")+a("b")+a("rb")+a("progress"))+"</div>").appendTo(y);L=d("background",b).click(P);e=d("dialog",b);d("caption",e);B=d("bottom",e).add(d("sideways",e));j=d("viewer",e);s=c("div:first",j);D=c("img:first",j);S=c("video",j);T=d("flash",j);ea=c([D[0],T[0]]).add(S);J=d("resizer",j).click(za);C=d("shrink",J);oa=d("rewind",e).click(Ea).hover(Ga,
ra);pa=d("forward",e).click(Fa).hover(Ha,ra);u=d("thumbs",e);f=c("ul",u);ia=d("prev",e).click(Q);ja=d("next",e).click(R);G=d("start",e).click(ya);H=d("stop",e).click(m);d("close",e).click(P);ka=d("download",e).click(Ca);la=d("metadata",e).click(ca);ta=o(e);ua=z(e,"height");j.css({height:0,width:0});M=o(e);N=z(e,"height");n=e.clone().appendTo(b)});c.fn.boxplus=function(a){return this.boxplusConfigure(a).click(function(a){U(a.currentTarget);return!1})};c.fn.boxplusGallery=function(a){da(this).boxplus(a);
return this};c.fn.boxplusDialog=function(a){U(this.boxplusConfigure(a)[0])};c.fn.boxplusConfigure=function(a){this.data("boxplus",c.extend({},a));return this};c.fn.boxplusGalleryConfigure=function(a){da(this).boxplusConfigure(a);return this};c.boxplus={change:r,previous:Q,next:R,refresh:I,configure:function(a){return c.extend(V,a)},onchange:c.noop}})(__jQuery__);
